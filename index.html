<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>disorient</title>
    <meta name="description" content="disorient">
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <style>
      #debug {
        position: absolute;
        background-color: #11111155;
        color: white;
        top: 5px;
        right: 5px;
        z-index: 1;
      }
    </style>
  </head>
  <body>
    <pre id="debug"></pre>
    <script>
      (() => {
        window.PLAYER = {}
        const debugWindow = document.getElementById('debug')

        AFRAME.registerComponent('camera-listener', {
          log : function () {
            var cameraEl = this.el.sceneEl.camera.el;
            var rotation = cameraEl.getAttribute('rotation');
            var worldPos = new THREE.Vector3();
            worldPos.setFromMatrixPosition(cameraEl.object3D.matrixWorld);
            window.PLAYER.position = worldPos
            window.PLAYER.position = worldPos
            const data =
              "Camera Position: (" + worldPos.x.toFixed(2) + ", " + worldPos.y.toFixed(2) + ", " + worldPos.z.toFixed(2) + ")\n" +
              "Camera Rotation: (" + rotation.x.toFixed(2) + ", " + rotation.y.toFixed(2) + ", " + rotation.z.toFixed(2) + ")"
            
            if (debugWindow.innerHTML !== data) {
              debugWindow.innerHTML = data
            }
          },

          play: function () {
            this.log();
          },

          tick: function () {
            this.log();
          },
        });
      })()
    </script>
    <a-scene>
      <a-assets>
        <img id="sky" src="./assets/sky-line.jpg">
        <img id="dark-grid" src="./assets/dark-grid.jpg">
        <img id="light-grid" src="./assets/light-grid.jpg">
      </a-assets>
      
      <!-- We can rotate and position the world to simulate artificial movement -->
      <a-entity id="world" position="0 0 0"rotation="0 0 0">
        <!-- Primitives. -->
        <a-box position="1.2 0.5 1.2" rotation="0 45 0" color="#FFFF00" src="#dark-grid" height="1" width="1" depth="1"></a-box>
        <a-sphere position="1 4 -1.5" radius="1.25" src="#dark-grid" repeat="10 10"></a-sphere>
        <a-cylinder position="-2 0.75 0" radius="0.5" height="1.5" color="#FF0000" src="#light-grid" repeat="5 5"></a-cylinder>

        <!-- Background sky. -->
        <!-- <a-sky height="2048" radius="30" src="#light-grid" repeat="20 10" color="purple" theta-length="90" width="2048" position="0 0 0"></a-sky> -->
        <a-sky height="2048" radius="30" src="#sky" theta-length="90" width="2048" position="0 0 0" rotation="0 0 0" repeat="5 5" animation="property: rotation; to: 0 360 0; dur: 200000; easing: linear; loop: true"></a-sky>
        <a-entity light="type: ambient; color: #BBB" position="0 4 0"></a-entity>

        <!-- Ground. -->
        <a-circle src="#dark-grid" rotation="-90 0 0" radius="32" material="repeat: 10 10"></a-circle>

        <!-- Walls and junk -->
        <a-box position="3 0 0" rotation="0 0 0" depth="6" height="8" width="0.25" color="#0000FF" src="#dark-grid" repeat="5 5"></a-box>
        <a-box position="0 0 -3" rotation="0 90 0" depth="6" height="6" width="0.25" color="#FF00FF" src="#dark-grid" repeat="5 5"></a-box>
        <a-box position="0 0 3" rotation="0 90 0" depth="6" height="2" width="0.25" color="#00FFFF" src="#dark-grid" repeat="5 5"></a-box>
        <a-box position="-3 0 0" rotation="0 0 0" depth="6" height="4" width="0.25" color="#00FF00" src="#dark-grid" repeat="5 5"></a-box>
      </a-entity>
      <!--Tracked controls. -->
      <a-entity hand-controls="hand: left"></a-entity>
      <a-entity hand-controls="hand: right"></a-entity>
      <a-entity camera-listener></a-entity>
    </a-scene>
  </body>
</html>
